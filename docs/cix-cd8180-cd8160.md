# CIX CD8180/CD8160 SoC

SoC-level documentation for CIX CD8180/CD8160 (codename: Sky1).

## Overview

- **CPU**: ARM Cortex-A76 + Cortex-A55 (big.LITTLE)
- **GPU**: Mali-G610 MP4
- **NPU**: 28.8 TOPS AIPU
- **ISP**: ARM Camera Block
- **VPU**: MVX Video (H.264/H.265, 4K@60fps)

## Components

### Kernel

**Vendor Kernel**: Linux 6.6.89-sky1 from orangepi-xunlong

**Features:**
- Complete hardware support for CD8180/CD8160
- Mali-G610 MP4 GPU drivers
- 28.8 TOPS NPU (AIPU) drivers  
- ISP (Image Signal Processor) drivers
- VPU (Video Processing Unit) drivers
- Device trees for all CD8180/CD8160 boards

**Build Commands:**

```bash
# Cross-compile from x86_64 (recommended)
nix build .#kernel-cross

# Native build on aarch64
nix build .#kernel

# With build logs (shows ccache stats)
nix build .#kernel-cross --print-build-logs

# Check kernel version
nix eval .#kernel-cross.version
```

**Documentation**: [pkgs/kernel/README.md](../pkgs/kernel/README.md)

### Drivers

**Kernel Modules**: GPU, NPU, ISP, VPU

**Build Commands:**

```bash
# Cross-compile from x86_64 (recommended)
nix build .#drivers-cross

# Native build on aarch64
nix build .#drivers

# With build logs
nix build .#drivers-cross --print-build-logs
```

**Included Drivers:**

| Driver | Package | License | Status |
|--------|---------|---------|--------|
| Mali-G610 MP4 GPU | `cix-gpu-umd` | Proprietary | Packaged, untested |
| 28.8 TOPS NPU | `cix-npu-umd` | Proprietary | Packaged, untested |
| ISP (Camera) | `cix-isp-umd` | Proprietary | Packaged, untested |
| VPU (Video) | `cix-vpu-firmware` | Proprietary | Packaged, untested |

**Documentation**: [pkgs/drivers/README.md](../pkgs/drivers/README.md)

### Firmware

**System Firmware**: GPU, NPU, ISP, VPU, WiFi, Bluetooth

**Build Commands:**

```bash
# Cross-compile from x86_64 (recommended)
nix build .#firmware-cross

# Native build on aarch64
nix build .#firmware
```

**Package**: `cix-firmware` (proprietary)

### SoC Tools

**CIX Tools**: I3C and Power Management utilities

**Build Commands:**

```bash
# Cross-compile from x86_64 (recommended)
nix build .#tools-cross

# Native build on aarch64
nix build .#tools
```

**Included Tools:**
- `i3ctransfer` - I3C bus communication utility
- `pmtool` - Power management utility

**Package**: `cix-tools` (proprietary)

## Hardware Support Status

| Component | Kernel Space | User Space | Status |
|-----------|--------------|------------|--------|
| **GPU** (Mali-G610 MP4) | ✅ mali-gpu.ko | ✅ cix-gpu-umd | Packaged, untested |
| **NPU** (28.8 TOPS) | ✅ aipu.ko | ✅ cix-npu-umd | Packaged, untested |
| **ISP** (Camera) | ✅ armcb-isp.ko | ✅ cix-isp-umd | Packaged, untested |
| **VPU** (Video codec) | ✅ mvx-vpu.ko | ✅ Firmware | Packaged, untested |
| **I3C** | ✅ In-tree | ✅ i3ctransfer | Packaged, untested |
| **Power Management** | ✅ In-tree | ✅ pmtool | Packaged, untested |
| **Ethernet** | ✅ In-tree (board-specific) | - | Working on boards |
| **NVMe** | ✅ nvme (in-tree) | - | Working on boards |
| **USB** | ✅ xhci_pci (in-tree) | - | Working on boards |

## Using SoC Components

### In Your NixOS Configuration

The SoC drivers and firmware are automatically included when you import a board module:

```nix
{
  imports = [ nixos-cix-cd8180.nixosModules.orangepi6plus ];
}
```

The board module includes the SoC base configuration which provides:
- Vendor kernel with all hardware drivers
- Kernel modules (GPU, NPU, ISP, VPU)
- Firmware packages
- SoC tools (i3ctransfer, pmtool)

### Kernel Selection

**Default**: Vendor kernel (recommended for full hardware support)

```nix
# This is set automatically by board modules
boot.kernelPackages = pkgs.cixSky1VendorKernelPackages;
```

**Override with Mainline**:

```nix
{
  # Use mainline kernel (some hardware may not work)
  boot.kernelPackages = pkgs.linuxPackages_latest;
}
```

**Note**: Mainline kernels lack GPU/NPU/ISP/VPU drivers.

### Adding SoC Packages

Drivers and tools are included by default in board configurations. For custom setups:

```nix
{
  environment.systemPackages = with pkgs; [
    cix-tools       # i3ctransfer, pmtool
    cix-firmware    # Firmware files
    # Drivers are kernel modules, loaded automatically
  ];
}
```

## Boards Using This SoC

| Board | Status | Documentation |
|-------|--------|---------------|
| Orange Pi 6 Plus | ✅ Building | [Board Guide](boards/orangepi-6-plus.md) |
| Radxa Orion O6 | ⚠️ Planned | N/A |

## Development

### Building Locally

```bash
# Build all SoC components (cross-compiled)
nix build .#kernel-cross
nix build .#drivers-cross
nix build .#firmware-cross
nix build .#tools-cross

# Enter development shell
nix develop           # General development
nix develop .#kernel  # Kernel-specific with cross-compile tools
```

### ccache for Kernel Builds

ccache is enabled by default for kernel builds:

- **First build**: ~35-40 minutes (populates ccache)
- **Incremental builds**: Much faster with ccache hits
- **Cache location**: `/tmp/ccache` (10 GB max)
- **Cache stats**: Shown in build logs (postBuild phase)

### Vendor Resources

- **Kernel Source**: [orangepi-xunlong/linux-orangepi](https://github.com/orangepi-xunlong/linux-orangepi) (branch: `orange-pi-6.1-cix`)
- **Drivers/Firmware**: [orangepi-xunlong/component_cix-current](https://github.com/orangepi-xunlong/component_cix-current)
- **Build System**: [orangepi-xunlong/orangepi-build](https://github.com/orangepi-xunlong/orangepi-build)

## Technical Specifications

### CPU Architecture

- **Big Cores**: ARM Cortex-A76 (high performance)
- **Little Cores**: ARM Cortex-A55 (power efficiency)
- **Architecture**: ARMv8.2-A (64-bit)
- **ISA**: AArch64

### GPU

- **Model**: ARM Mali-G610 MP4
- **API Support**: OpenGL ES 3.2, Vulkan 1.2, OpenCL 2.2
- **Cores**: 4 shader cores

### NPU

- **Performance**: 28.8 TOPS (INT8)
- **Type**: ARM China Zhouyi AIPU
- **Precision**: INT8, INT16, FP16 support

### ISP

- **Type**: ARM Camera Block ISP
- **Support**: RAW sensor input, image processing pipeline

### VPU

- **Type**: MVX Video Processing Unit
- **Codecs**: H.264, H.265/HEVC hardware encode/decode
- **Resolution**: Up to 4K@60fps

## Package Structure

```
pkgs/
├── kernel/          # Vendor and mainline kernel packages
│   ├── vendor.nix   # 6.6.89-sky1 (recommended)
│   └── mainline.nix # Future mainline support
├── drivers/         # Proprietary drivers
│   ├── gpu/         # Mali-G610 MP4
│   ├── npu/         # 28.8 TOPS AIPU
│   ├── isp/         # Camera ISP
│   └── vpu/         # Video codec
├── firmware/        # System firmware
└── cix-tools/       # I3C, power management tools

modules/
└── soc/
    └── sky1.nix     # Base SoC configuration
```

## References

- [Main README](../README.md) - Project overview
- [Installation Guide](installation.md) - Installing NixOS
- [Development Guide](development.md) - Building and testing
- [Kernel README](../pkgs/kernel/README.md) - Kernel details
- [Drivers README](../pkgs/drivers/README.md) - Driver details
- [Orange Pi 6 Plus Board Guide](boards/orangepi-6-plus.md) - Board-specific documentation
